/* @license
 * Rams <https://github.com/jacobxperez/rams/>
 * Copyright (C) 2023 Jacob Perez <jacobxperez@gmx.com>
 * Licensed under the Apache License, Version 2.0
 * http://www.apache.org/licenses/LICENSE-2.0
 */
document.addEventListener("click",(t=>{const e=t.target.closest("[data-toggle]");e?(e.hasAttribute("data-state","active")?e.removeAttribute("data-state"):e.setAttribute("data-state","active"),t.stopPropagation()):document.querySelectorAll("[data-toggle]").forEach((e=>{(t.target!==e&&e.matches('[data-toggle~="pop"]')||e.matches('[data-toggle~="tooltip"]'))&&e.removeAttribute("data-state")}))}));new class{constructor({carouselSelector:t="[data-carousel]",slideSelector:e="[data-slide]",controlsSelector:s="[data-controls]",tabSelector:i="[data-tab]",intervalTime:a=5e3,lazyLoadThreshold:r=2}={}){if(this.carousel=document.querySelector(t),!this.carousel)throw new Error("Carousel element not found in the DOM");this.slides=this.carousel.querySelectorAll(e),this.controls=this.carousel.querySelector(s)??this.#t(),this.tabs=Array.from(this.controls.querySelectorAll(i)),this.button=document.createElement("button"),this.intervalTime=a,this.lazyLoadThreshold=r,this.currentIndex=0,this.indicators=!1,this.paused=!0,this.#e()}async#e(){await this.#s(),this.#i(),this.controls.addEventListener("click",this.#a.bind(this)),this.tabs.forEach(((t,e)=>t.setAttribute("data-index",e)))}#t(){const t=document.createElement("nav");return t.setAttribute("data-controls",""),this.carousel.appendChild(t),t}async#s(){const t=Array.from(this.slides).slice(0,this.lazyLoadThreshold).map((t=>{const e=t.querySelector("img");if(e)return new Promise(((t,s)=>{const i=new Image;i.src=e.src,i.onload=t,i.onerror=s}))}));await Promise.all(t)}#r(){const t=this.controls.querySelector(`[data-index="${this.currentIndex}"]`),e=this.controls.querySelector('[data-state="active"]');t.setAttribute("data-state","active"),e?.removeAttribute("data-state"),requestAnimationFrame((()=>{this.tabs.filter((s=>![t,e].includes(s))).forEach((t=>t.removeAttribute("data-state")))}))}#i(){const t=this.slides[this.currentIndex];t.setAttribute("data-state","current"),requestAnimationFrame((()=>{Array.from(this.slides).filter((e=>e!==t)).forEach((t=>t.removeAttribute("data-state")))})),this.indicators&&this.#r()}#n(t){"next"===t?(this.currentIndex++,this.currentIndex>this.slides.length-1&&(this.currentIndex=0)):"prev"===t&&(this.currentIndex--,this.currentIndex<0&&(this.currentIndex=this.slides.length-1)),this.#i()}#a(t){const e=t.target;e.matches('[data-button="next-slide"]')?(this.#n("next"),this.#o()):e.matches('[data-button="prev-slide"]')?(this.#n("prev"),this.#o()):e.matches("[data-index]")&&(this.#d(),this.currentIndex=Number(e.getAttribute("data-index")),this.#i())}addControls(){const t=this.button.cloneNode(!0),e=this.button.cloneNode(!0);return t.setAttribute("data-button","prev-slide"),e.setAttribute("data-button","next-slide"),this.controls.appendChild(t),this.controls.appendChild(e),this}addIndicators(){const t=document.createElement("div");t.setAttribute("data-indicator","tabs");for(let e=0;e<this.slides.length;e++){const s=this.button.cloneNode(!0);s.setAttribute("data-index",e),s.setAttribute("data-tab","indicator"),t.appendChild(s)}return this.controls.appendChild(t),this.indicators=!0,this}addTouchControls(){return this.carousel.addEventListener("touchstart",this.#h.bind(this)),this.carousel.addEventListener("touchmove",this.#c.bind(this)),this.carousel.addEventListener("touchend",this.#l.bind(this)),this}#h(t){this.touchStartX=t.touches[0].clientX,this.touchEndX=this.touchStartX}#c(t){this.touchEndX=t.touches[0].clientX}#l(){if(void 0!==this.touchStartX&&void 0!==this.touchEndX){const t=this.touchEndX-this.touchStartX;t>0?(this.#n("prev"),this.#o()):t<0&&(this.#n("next"),this.#o())}}addKeyboardControls(){return document.addEventListener("keydown",this.#u.bind(this)),this}#u(t){switch(t.key){case"ArrowLeft":this.#n("prev"),this.#o();break;case"ArrowRight":this.#n("next"),this.#o()}}start(t=this.intervalTime){return this.paused=!1,this.interval=setInterval((()=>{this.#n("next")}),t),this}#d(){return this.paused=!0,clearInterval(this.interval),this}#o(){return this.#d().start(),this}}({}).addControls().addIndicators().addTouchControls().addKeyboardControls().start();