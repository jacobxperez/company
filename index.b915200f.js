/* @license
 * Rams <https://github.com/jacobxperez/rams/>
 * Copyright (C) 2023 Jacob Perez <jacobxperez@gmx.com>
 * Licensed under the Apache License, Version 2.0
 * http://www.apache.org/licenses/LICENSE-2.0
 */
document.addEventListener("click",(t=>{const e=t.target.closest("[data-toggle]");e?(e.hasAttribute("data-state","active")?e.removeAttribute("data-state"):e.setAttribute("data-state","active"),t.stopPropagation()):document.querySelectorAll("[data-toggle]").forEach((e=>{(t.target!==e&&e.matches('[data-toggle~="pop"]')||e.matches('[data-toggle~="tooltip"]'))&&e.removeAttribute("data-state")}))}));new class{constructor({carouselSelector:t="[data-carousel]",slideSelector:e="[data-slide]",controlsSelector:s="[data-controls]",tabSelector:i="[data-tab]",intervalTime:a=5e3,lazyLoadThreshold:r=2}={}){if(this.carousel=document.querySelector(t),!this.carousel)throw new Error("Carousel element not found in the DOM");this.slides=this.carousel.querySelectorAll(e),this.controls=this.carousel.querySelector(s)??this.createControls(),this.tabs=Array.from(this.controls.querySelectorAll(i)),this.button=document.createElement("button"),this.intervalTime=a,this.lazyLoadThreshold=r,this.currentIndex=0,this.indicators=!1,this.paused=!0,this.initialize()}async initialize(){await this.preloadImages(),this.cycleSlides(),this.controls.addEventListener("click",this.handleControls.bind(this)),this.tabs.forEach(((t,e)=>t.setAttribute("data-index",e)))}createControls(){const t=document.createElement("nav");return t.setAttribute("data-controls",""),this.carousel.appendChild(t),t}async preloadImages(){const t=Array.from(this.slides).slice(0,this.lazyLoadThreshold).map((t=>{const e=t.querySelector("img");if(e)return new Promise(((t,s)=>{const i=new Image;i.src=e.src,i.onload=t,i.onerror=s}))}));await Promise.all(t)}cycleTabs(){const t=this.controls.querySelector(`[data-index="${this.currentIndex}"]`),e=this.controls.querySelector('[data-state="active"]');t.setAttribute("data-state","active"),e?.removeAttribute("data-state"),requestAnimationFrame((()=>{this.tabs.filter((s=>![t,e].includes(s))).forEach((t=>t.removeAttribute("data-state")))}))}cycleSlides(){const t=this.slides[this.currentIndex];t.setAttribute("data-state","current"),requestAnimationFrame((()=>{Array.from(this.slides).filter((e=>e!==t)).forEach((t=>t.removeAttribute("data-state")))})),this.indicators&&this.cycleTabs()}changeSlide(t){"next"===t?(this.currentIndex++,this.currentIndex>this.slides.length-1&&(this.currentIndex=0)):"prev"===t&&(this.currentIndex--,this.currentIndex<0&&(this.currentIndex=this.slides.length-1)),this.cycleSlides()}handleControls(t){const e=t.target;e.matches('[data-button="next-slide"]')?(this.changeSlide("next"),this.resume()):e.matches('[data-button="prev-slide"]')?(this.changeSlide("prev"),this.resume()):e.matches("[data-index]")&&(this.pause(),this.currentIndex=Number(e.getAttribute("data-index")),this.cycleSlides())}addControls(){const t=this.button.cloneNode(!0),e=this.button.cloneNode(!0);return t.setAttribute("data-button","prev-slide"),e.setAttribute("data-button","next-slide"),this.controls.appendChild(t),this.controls.appendChild(e),this}addIndicators(){const t=document.createElement("div");t.setAttribute("data-indicator","tabs");for(let e=0;e<this.slides.length;e++){const s=this.button.cloneNode(!0);s.setAttribute("data-index",e),s.setAttribute("data-tab","indicator"),t.appendChild(s)}return this.controls.appendChild(t),this.indicators=!0,this}addTouchControls(){return this.carousel.addEventListener("touchstart",this.handleTouchStart.bind(this)),this.carousel.addEventListener("touchmove",this.handleTouchMove.bind(this)),this.carousel.addEventListener("touchend",this.handleTouchEnd.bind(this)),this}handleTouchStart(t){this.touchStartX=t.touches[0].clientX,this.touchEndX=this.touchStartX}handleTouchMove(t){this.touchEndX=t.touches[0].clientX}handleTouchEnd(){if(void 0!==this.touchStartX&&void 0!==this.touchEndX){const t=this.touchEndX-this.touchStartX;t>0?(this.changeSlide("prev"),this.resume()):t<0&&(this.changeSlide("next"),this.resume())}}addKeyboardControls(){return document.addEventListener("keydown",this.handleKeyDown.bind(this)),this}handleKeyDown(t){switch(t.key){case"ArrowLeft":this.changeSlide("prev"),this.resume();break;case"ArrowRight":this.changeSlide("next"),this.resume()}}start(t=this.intervalTime){return this.interval=setInterval((()=>{this.changeSlide("next")}),t),this.paused=!1,this}pause(){return this.paused=!0,clearInterval(this.interval),this}resume(){return this.paused&&(this.paused=!1,this.interval=setInterval((()=>{this.changeSlide("next")}),this.intervalTime)),this}stop(){return this.pause(),this.currentIndex=0,this.cycleSlides(),this}}({}).addControls().addIndicators().addTouchControls().addKeyboardControls().start();